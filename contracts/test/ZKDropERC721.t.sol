// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "forge-std/console.sol";
import {ZKDropERC721} from "src/ZKDropERC721.sol";
import {CommitmentMapperRegistryMock} from "test/mocks/CommitmentMapperRegistryMock.sol";
import {AvailableRootsRegistryMock} from "test/mocks/AvailableRootsRegistryMock.sol";
import "sismo-connect-solidity/SismoLib.sol";

contract ZKDropERC721Test is Test {
    bytes16 immutable APP_ID = 0x11b1de449c6c4adb0b5775b3868b28b3;
    bytes16 immutable ZK = 0xe9ed316946d3d98dfcd829a53ec9822e;
    address user = 0x040200040600000201150028570102001e030E26;
    ZKDropERC721 zkdrop;

    address immutable addressesProviderOwner = 0xaee4acd5c4Bf516330ca8fe11B07206fC6709294;

    function setUp() public {
        zkdrop = new ZKDropERC721({
            appId: APP_ID,
            groupId: ZK,
            name: "ZKDrop test",
            symbol: "test",
            baseTokenURI: "https://test.com"
        });
        console.log("ZkDrop contract deployed at", address(zkdrop));

        vm.startPrank(0xa687922C4bf2eB22297FdF89156B49eD3727618b);
        address(0xF3dAc93c85e92cab8f811b3A3cCaCB93140D9304).call(
            abi.encodeWithSignature(
                "registerRoot(uint256)",
                0x11F7FDE533960EA368AB0AF29E6690687BB97FF54AF42F77A071ADF0E5A0EF7B
            )
        );
        vm.stopPrank();
    }

    function testClaimAndAuthWithSignedMessage() public {
        bytes memory zkConnectResponseEncoded =
            hex"000000000000000000000000000000000000000000000000000000000000002011b1de449c6c4adb0b5775b3868b28b300000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000040200040600000201150028570102001e030e2600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000e9ed316946d3d98dfcd829a53ec9822e000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c022cd2c3d0e04e23ef95c0ea176bfccdbff065a6f9e3ba3eb54f7f96081e40368068b89d4b5b86d17928f1d6ea300b873f6939fbf0f48811b03498a4945b95edc233d6db5270b190e8da538baaeeece0924a8a76a060fa6a64385b6b2f76235590111afcd7f1fce798e2b6d382fcc928577563bf5a11138990b47e63f53c812c41dc74e05bd1abb5bdea3be8d9f8b04d17614d751421ae253e4db2f64f43c0f531d646e9f44945859f6d7f3b1c070a95bd0ef92f312547a30f27f25c447bfae582782ce59d576141a3330bf42a5b7d6fe4e3122d0c3851e46ff0e8cf61fcdcb0a02b918028a13334e899128196bbc430fc03c30e4a35490a8615622c5d1eaedbe00000000000000000000000000000000000000000000000000000000000000001e762fcc1e79cf55469b1e6ada7c8f80734bc7484f73098f3168be945a2c00842ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db7411f7fde533960ea368ab0af29e6690687bb97ff54af42f77a071adf0e5a0ef7b04f81599b826fa9b715033e76e5b2fdda881352a9b61360022e30ee33ddccad90744e9b92802056c722ac4b31612e1b1de544d5b99481386b162a0b59862e0850000000000000000000000000000000000000000000000000000000000000001285bf79dc20d58e71b9712cb38c420b9cb91d3438c8e3dbaf07829b03ffffffc000000000000000000000000000000000000000000000000000000000000000018202c14c40a8bc84b8fc8748836190f53fc45c66ad969c7bfa2a91afdd1ad8d01935d4d418952220ae0332606f61de2894d8b84c3076e6097ef3746a1ba04a500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000118202c14c40a8bc84b8fc8748836190f53fc45c66ad969c7bfa2a91afdd1ad8d00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0189fd81a41ee5e8c06d8df4b3fd820d857d0d9b2f2ab6768483eafc13e2b2fba2b7178017254791c3a2180b654f53f2387297ff3dc1eb5509305479289eba21f1e9bfc1b2192f5a1b469db852f43401215488dc0d6c5cd905b939e0e632e863804f241e5b46ac04fa75b1c1fbcacc921ca0f82b3e7a8630693c2708d7c52aa1a088e7c4718dc237575a6e23baa00445ceab1ff88fd25132e59a7abc48077d200254649d55493c8a65f7a73e31b6fda84b15b72641b173482918062e5b47cb0d223d021f7bdaac10210d53de512ac78887939b64fc6fee0c775480ce5455cff36191ceea9996207c56401682ea9628c05cbf2e904cedf703d3053aa8464c69d4700000000000000000000000000000000000000000000000000000000000000001e762fcc1e79cf55469b1e6ada7c8f80734bc7484f73098f3168be945a2c00842ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018202c14c40a8bc84b8fc8748836190f53fc45c66ad969c7bfa2a91afdd1ad8d01935d4d418952220ae0332606f61de2894d8b84c3076e6097ef3746a1ba04a5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        zkdrop.claimWithSismoConnect(zkConnectResponseEncoded, user);
    }

    function getEdDSAPubKey() public pure returns (uint256[2] memory) {
        return [
            0x7f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb9,
            0x20706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa
        ];
    }

    function getRoot() public pure returns (uint256) {
        return 0x1d4a72bd1c1e4f9ab68c3c4c55afd3e582685a18b9ec09fc96136619d2513fe8;
    }
}
